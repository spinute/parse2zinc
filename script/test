#!/bin/bash

ZINC=~/Dropbox/program/parse2zinc
ANS=$ZINC/tmp/answer
GENERATE=$ZINC/bin/opti_main
BENCH=$ZINC/benchmarks

FD=~/1123fast
TRANSRATE=$FD/src/translate/translate.py 
VALIDATE=$FD/src/VAL/validate

# !!!!
#change these variable for change domain and problem

THISDOM=gripper
THISPROB=prob01.pddl
DOMAIN=$BENCH/$THISDOM/domain.pddl
# !!!!

###### do
PROBLEM=$BENCH/$THISDOM/$THISPROB
RESULT=opti_result
VALIDATE_RESULT=$ZINC/${RESULT}/validate_${THISDOM}_${THISPROB}

$TRANSRATE $DOMAIN $PROBLEM
mv output.sas $ZINC/tmp

$GENERATE $ZINC/tmp/output.sas

###### VAL
$VALIDATE $DOMAIN $PROBLEM $ANS > $VALIDATE_RESULT

TESTLOG=$ZINC/$RESULT/testlog
echo $VALIDATE_RESULT | $ZINC/bin/check_valid >> $TESTLOG
echo "$THISDOM: $THISPROB" >> $TESTLOG

###### compare with fastdownward result
$FD/src/preprocess/preprocess < $ZINC/tmp/output.sas
$FD/src/fast-downward.py --alias seq-sat-lama-2011 output

if [ -f $ZINC/objval ]; then
	$ZINC/script/get_planValue $THISDOM $THISPROB >> $TESTLOG
	mv $ZINC/sas_plan $ZINC/output $ZINC/objval $ZINC/tmp
fi

date >> $TESTLOG
echo "" >> $TESTLOG

###### 実験はmasterからやろう
git commit -am 'autocommit for test'

if [ -f $ZINC/sas_plan.* ]; then
	mv $ZINC/sas_plan.* $ZINC/tmp
fi

exit 0